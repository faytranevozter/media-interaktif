$(document).ready(function () {
	var e = 0,
	setatus, exp = 5,
	nNow, permanent, music=0, audioVol;
	if (window.localStorage.getItem("perm") === null) {
		window.localStorage.setItem('perm', 0);
		window.localStorage.setItem('exp', 1);
		permanent = window.localStorage.getItem("perm");
		nNow = window.localStorage.getItem("exp")
	} else {
		permanent = window.localStorage.getItem("perm");
		nNow = window.localStorage.getItem("exp");
		nNow++;
		window.localStorage.setItem('exp', nNow)
	};
	function checkExp() {
		if (permanent != true) {
			if (nNow >= exp) {
				var a = $('body > .blockall').length;
				if (a > 0) {
					$('.blockall').removeClass('hide')
				} else {
					$('body').prepend("<div class='blockall'></div>")
				}
			}
		} else {
			var b = $('.nav-bottom .navbar.right li a.restore-purchase').length;
			if (b == 0) {
				$('.nav-bottom .navbar.right').prepend("<li><a href='#' class='restore-purchase'>Restore Purchase</a></li>")
			}
		};
	};
	checkExp();
	$('#navigation li a').on('click', function () {
		var a = $(this).attr('data-target');
		var b = $('#navigation li.active');
		var c = $('#showcontent .msgs.active');
		var d = $('#showcontent .msgs[data-id=' + a + ']');
		checkExp();
		if (a) {
			if (!$('#showcontent .msgs[data-id=' + a + ']').hasClass('active')) {
				$(this).closest('li').addClass('active');
				b.removeClass('active');
				c.fadeOut(200, function () {
					$(this).removeClass('active');
					d.fadeIn(200).addClass('active')
				})
			}
		} else {
			return false
		}
	});
	$('#msg-0').hide();
	function showOut(a) {
		var b = $('#showcontent .msgs.active');
		var c = $('#showcontent .msgs[data-id=' + a + ']');
		b.fadeOut(200, function () {
			$(this).removeClass('active');
			c.fadeIn(200).addClass('active')
		})
	}
	function next_soal(a) {
		var b = $('#showcontent .msgs.active');
		var c = $('#showcontent .msgs[data-id=soal-' + a + ']');
		b.fadeOut(200, function () {
			$(this).removeClass('active');
			c.fadeIn(200).addClass('active')
		})
	}
	function login() {
		var a = $('input#nama').val();
		a = a.trim();
		if (a) {
			$('span.nama-orang').text(a);
			next_soal(1)
		} else {
			$('#msg-0').slideDown();
			setTimeout(function () {
				$('#msg-0').fadeOut()
			},
			3000)
		}
	}
	$('#loginbox').on('submit', function () {
		login();
		checkExp();
		return false
	});
	$('a.button-next').on('click', function () {
		var a = $("[data-id^=soal-]").length;
		var b = $(this).attr('data-now');
		var c = $(this).attr('data-last');
		var d = $('input[type=radio][name=s-' + b + ']:checked').val();
		d = parseInt(d);
		checkExp();
		if (d) {
			e++
		};
		if (c) {
			e = ((e * 10) / a).toFixed(2);
			setatus = e > 7 ? 'Anda Pintar': 'Anda Bodoh';
			$('h1.nilai-akhir').text(e);
			$('h1.setatus').text(setatus);
			showOut('hasil');
			e = 0
		} else {
			b = parseInt(b);
			next_soal(b + 1)
		}
	});
	$('button#mulai-lagi').on('click', function () {
		showOut('login-soal');
		checkExp();
		e = 0
	});
	$('form.pay-form').on('submit', function () {
		var a = $('form.pay-form input[name=serial]').val();
		a = a.trim();
		a = a.toUpperCase();
		if (a) {
			if (a == "FAYG-ANTE-NGBA-NGET") {
				$('#msg-2').text('You Have Extend for 15 times more.');
				$('#msg-2').slideDown();
				window.localStorage.setItem('exp', -10);
				nNow = -10;
				setTimeout(function () {
					$('#msg-2').slideUp(500, function () {
						$('.blockall').addClass('hide')
					})
				},
				2000)
			} else if (a == "GETT-HISP-ERMA-NENT") {
				$('#msg-2').text('Thanks for Purchasing :)');
				$('#msg-2').slideDown();
				window.localStorage.setItem('perm', 1);
				permanent = 1;
				setTimeout(function () {
					$('#msg-2').slideUp(500, function () {
						$('.blockall').addClass('hide')
					})
				},
				2000)
			} else {
				$('#msg-1').slideDown();
				setTimeout(function () {
					$('#msg-1').slideUp()
				},
				3000)
			}
		};
		return false
	});
	$('.nav-bottom .navbar.right').on('click', 'li a.restore-purchase', function () {
		window.localStorage.setItem('perm', 0);
		permanent = 0;
		$('a.restore-purchase').closest('li').remove();
		$('form.pay-form input[name=serial]').val('')
	});

	$('li a.audio').on('click', function(){
		if (!music) {
			music = new Audio('music/KP-BF2B.mp3');
			music.volume = 0.5;
		};
		if (music.paused == false) {
			mx_pause();
		} else {
			mx_play();
		}
	});

	$('.audio-vol').on('mousemove change', function(){
		audioVol = ($(this).val()/100);
		music.volume = audioVol;
	});

	function mx_play() {
		music.play();
		$('li a.audio span.glyphicon').removeClass('glyphicon-play').addClass('glyphicon-pause');
		$('li a.audio span.audio-text').text('Pause');
	};
	function mx_pause() {
		music.pause();
		$('li a.audio span.glyphicon').removeClass('glyphicon-pause').addClass('glyphicon-play');
		$('li a.audio span.audio-text').text('Play');
	};
});